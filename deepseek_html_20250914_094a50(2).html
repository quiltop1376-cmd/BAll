<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Поймай шарики - Экстремальная версия</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f1b4d, #8a1a1a, #d89b1d);
            color: white;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .game-title {
            font-size: 2.8rem;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            color: #FFD700;
            animation: pulse 1.5s infinite;
            letter-spacing: 2px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 10px #FFD700; }
            50% { transform: scale(1.08); text-shadow: 0 0 20px #FFD700, 0 0 30px #FF6B00; }
            100% { transform: scale(1); text-shadow: 0 0 10px #FFD700; }
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .difficulty-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.4);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .difficulty-btn:hover::before {
            left: 100%;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(45deg, #FF512F, #DD2476);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(221, 36, 118, 0.8);
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 700px;
            margin-bottom: 20px;
            font-size: 1.3rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 18px;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .game-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            height: 450px;
            border: 4px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.6);
            background: rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }
        
        .ball {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
            transition: transform 0.2s;
            animation: appear 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }
        
        .ball.bonus {
            animation: glow 1s infinite alternate, rotate 4s infinite linear;
            box-shadow: 0 0 25px #FFD700;
            border: 2px solid #FFD700;
        }
        
        .ball.penalty {
            animation: shake 0.5s infinite alternate;
            box-shadow: 0 0 20px #FF0000;
            border: 2px solid #FF0000;
        }
        
        @keyframes appear {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 15px #FFD700; }
            to { box-shadow: 0 0 35px #FFD700, 0 0 50px #FF9D00; }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes shake {
            from { transform: translateX(-3px) translateY(-3px); }
            to { transform: translateX(3px) translateY(3px); }
        }
        
        .ball:hover {
            transform: scale(1.15);
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 14px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            background: linear-gradient(to right, #FF512F, #DD2476);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #DD2476, #FF512F);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }
        
        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        button:hover::before {
            opacity: 1;
        }
        
        button:active {
            transform: translateY(2px);
        }
        
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8);
            opacity: 0;
            transition: opacity 0.5s;
            text-align: center;
            z-index: 10;
            pointer-events: none;
            color: #FFD700;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }
        
        .score-popup {
            position: absolute;
            color: #FFD700;
            font-weight: bold;
            pointer-events: none;
            animation: scorePopup 1s forwards;
            z-index: 5;
            font-size: 1.8rem;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8);
        }
        
        .penalty-popup {
            position: absolute;
            color: #FF0000;
            font-weight: bold;
            pointer-events: none;
            animation: scorePopup 1s forwards;
            z-index: 5;
            font-size: 1.8rem;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8);
        }
        
        @keyframes scorePopup {
            0% {
                transform: translate(0, 0) scale(0.5);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translate(0, -70px) scale(1.3);
                opacity: 0;
            }
        }
        
        .stats-panel {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            width: 100%;
            max-width: 700px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .stats-panel div {
            padding: 8px;
            font-size: 1.2rem;
        }
        
        .achievements {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 700px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .achievements h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #FFD700;
            font-size: 1.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        .achievement-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .achievement {
            background: rgba(255, 215, 0, 0.15);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            min-width: 120px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .achievement.unlocked {
            background: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            transform: scale(1.05);
        }
        
        .custom-settings {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 700px;
            margin-bottom: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
            display: none;
        }
        
        .custom-settings h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #FFD700;
            font-size: 1.5rem;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .settings-item {
            display: flex;
            flex-direction: column;
        }
        
        .settings-item label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #FFD700;
        }
        
        .settings-item input {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-weight: bold;
        }
        
        .settings-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .combo-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            display: none;
        }
        
        .level-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .donation-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            text-align: center;
            width: 100%;
            max-width: 700px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .donation-section p {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #FFD700;
        }
        
        .donation-link {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(to right, #FF512F, #DD2476);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .donation-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        @media (max-width: 700px) {
            .game-title {
                font-size: 2.2rem;
            }
            
            .game-info {
                flex-direction: column;
                gap: 12px;
                text-align: center;
                font-size: 1.1rem;
            }
            
            .game-container {
                height: 350px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 220px;
            }
            
            .stats-panel {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .message {
                font-size: 2.2rem;
                padding: 15px 30px;
            }
            
            .donation-section {
                padding: 10px;
            }
            
            .donation-section p {
                font-size: 1rem;
            }
        }
        
        /* Анимация исчезновения для шариков */
        @keyframes disappear {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        /* Движущиеся шарики */
        .ball.moving {
            animation: moveBall 5s linear infinite;
        }
        
        @keyframes moveBall {
            0% { transform: translate(0, 0); }
            25% { transform: translate(30px, 40px); }
            50% { transform: translate(10px, 80px); }
            75% { transform: translate(-20px, 40px); }
            100% { transform: translate(0, 0); }
        }
    </style>
</head>
<body>
    <h1 class="game-title">Поймай шарики! Экстрим</h1>
    
    <div class="difficulty-selector">
        <button class="difficulty-btn active" data-difficulty="easy">Легкий</button>
        <button class="difficulty-btn" data-difficulty="medium">Средний</button>
        <button class="difficulty-btn" data-difficulty="hard">Сложный</button>
        <button class="difficulty-btn" data-difficulty="hardcore">ХАРДКОР</button>
        <button class="difficulty-btn" data-difficulty="custom">Свой уровень</button>
    </div>
    
    <div class="game-info">
        <div>Очки: <span id="score">0</span></div>
        <div>Время: <span id="time">30</span> сек</div>
        <div>Комбо: <span id="combo">x1</span></div>
    </div>
    
    <div class="game-container" id="gameContainer">
        <div class="message" id="message"></div>
        <div class="level-indicator" id="levelIndicator">Легкий уровень</div>
        <div class="combo-counter" id="comboCounter">Комбо: x1</div>
    </div>
    
    <div class="controls">
        <button id="startBtn">Начать игру</button>
        <button id="resetBtn">Сбросить</button>
    </div>
    
    <div class="stats-panel">
        <div>Поймано: <span id="caught">0</span></div>
        <div>Пропущено: <span id="missed">0</span></div>
        <div>Точность: <span id="accuracy">0%</span></div>
        <div>Бонусы: <span id="bonus">0</span></div>
        <div>Штрафы: <span id="penalty">0</span></div>
        <div>Макс. комbo: <span id="maxCombo">x1</span></div>
    </div>
    
    <div class="custom-settings" id="customSettings">
        <h3>Настройки своего уровня</h3>
        <div class="settings-grid">
            <div class="settings-item">
                <label for="customMinSize">Минимальный размер:</label>
                <input type="number" id="customMinSize" min="5" max="100" value="20">
            </div>
            <div class="settings-item">
                <label for="customMaxSize">Максимальный размер:</label>
                <input type="number" id="customMaxSize" min="10" max="100" value="40">
            </div>
            <div class="settings-item">
                <label for="customLifetime">Время жизни (мс):</label>
                <input type="number" id="customLifetime" min="500" max="5000" step="100" value="1500">
            </div>
            <div class="settings-item">
                <label for="customInterval">Интервал появления (мс):</label>
                <input type="number" id="customInterval" min="100" max="3000" step="100" value="500">
            </div>
            <div class="settings-item">
                <label for="customBonusChance">Шанс бонуса (0-1):</label>
                <input type="number" id="customBonusChance" min="0" max="1" step="0.05" value="0.2">
            </div>
            <div class="settings-item">
                <label for="customPenaltyChance">Шанс штрафа (0-1):</label>
                <input type="number" id="customPenaltyChance" min="0" max="1" step="0.05" value="0.15">
            </div>
            <div class="settings-item">
                <label for="customMovingChance">Шанс движения (0-1):</label>
                <input type="number" id="customMovingChance" min="0" max="1" step="0.05" value="0.3">
            </div>
            <div class="settings-item">
                <label for="customGameTime">Время игры (сек):</label>
                <input type="number" id="customGameTime" min="10" max="300" value="25">
            </div>
        </div>
        <div class="settings-buttons">
            <button id="saveCustom">Сохранить настройки</button>
            <button id="applyCustom">Применить уровень</button>
        </div>
    </div>
    
    <div class="achievements">
        <h3>Достижения</h3>
        <div class="achievement-list">
            <div class="achievement" id="ach1">Новичок (50 очков)</div>
            <div class="achievement" id="ach2">Охотник (150 очков)</div>
            <div class="achievement" id="ach3">Мастер (300 очков)</div>
            <div class="achievement" id="ach4">Экстрим (500 очков)</div>
        </div>
    </div>

    <div class="donation-section">
        <p>Для тех, кто хочет поддержать автора:</p>
        <a href="https://www.donationalerts.com/r/playaleks" class="donation-link" target="_blank">Поддержать проект</a>
    </div>

    <script>
        // Элементы DOM
        const gameContainer = document.getElementById('gameContainer');
        const scoreElement = document.getElementById('score');
        const timeElement = document.getElementById('time');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const messageElement = document.getElementById('message');
        const caughtElement = document.getElementById('caught');
        const missedElement = document.getElementById('missed');
        const accuracyElement = document.getElementById('accuracy');
        const bonusElement = document.getElementById('bonus');
        const penaltyElement = document.getElementById('penalty');
        const comboElement = document.getElementById('combo');
        const maxComboElement = document.getElementById('maxCombo');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const achievements = document.querySelectorAll('.achievement');
        const saveCustomBtn = document.getElementById('saveCustom');
        const applyCustomBtn = document.getElementById('applyCustom');
        const levelIndicator = document.getElementById('levelIndicator');
        const comboCounter = document.getElementById('comboCounter');
        
        // Переменные игры
        let score = 0;
        let timeLeft = 30;
        let gameInterval;
        let ballInterval;
        let gameActive = false;
        let currentDifficulty = 'easy';
        let ballsCaught = 0;
        let ballsMissed = 0;
        let bonusCaught = 0;
        let penaltyCaught = 0;
        let combo = 1;
        let maxCombo = 1;
        let comboTimeout;
        let movingBalls = false;
        
        // Настройки уровней сложности (усложненные)
        const difficultySettings = {
            easy: {
                minSize: 45,
                maxSize: 70,
                ballLifetime: 3000,
                spawnInterval: 1000,
                bonusChance: 0.1,
                penaltyChance: 0.05,
                movingChance: 0.1,
                gameTime: 30,
                levelName: "Легкий уровень"
            },
            medium: {
                minSize: 35,
                maxSize: 60,
                ballLifetime: 2500,
                spawnInterval: 800,
                bonusChance: 0.15,
                penaltyChance: 0.1,
                movingChance: 0.2,
                gameTime: 30,
                levelName: "Средний уровень"
            },
            hard: {
                minSize: 25,
                maxSize: 50,
                ballLifetime: 2000,
                spawnInterval: 600,
                bonusChance: 0.2,
                penaltyChance: 0.15,
                movingChance: 0.3,
                gameTime: 30,
                levelName: "Сложный уровень"
            },
            hardcore: {
                minSize: 15,
                maxSize: 40,
                ballLifetime: 1500,
                spawnInterval: 400,
                bonusChance: 0.25,
                penaltyChance: 0.2,
                movingChance: 0.5,
                gameTime: 25,
                levelName: "ХАРДКОР уровень"
            },
            custom: {
                minSize: 20,
                maxSize: 40,
                ballLifetime: 1500,
                spawnInterval: 500,
                bonusChance: 0.2,
                penaltyChance: 0.15,
                movingChance: 0.3,
                gameTime: 25,
                levelName: "Пользовательский уровень"
            }
        };
        
        // Цвета для шариков
        const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41'];
        
        // Выбор уровня сложности
        difficultyButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (gameActive) return;
                
                difficultyButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.difficulty;
                
                // Установка времени игры в зависимости от сложности
                timeLeft = difficultySettings[currentDifficulty].gameTime;
                timeElement.textContent = timeLeft;
                
                // Обновление индикатора уровня
                levelIndicator.textContent = difficultySettings[currentDifficulty].levelName;
                
                // Показать/скрыть настройки для пользовательского уровня
                if (currentDifficulty === 'custom') {
                    document.getElementById('customSettings').style.display = 'block';
                } else {
                    document.getElementById('customSettings').style.display = 'none';
                }
            });
        });
        
        // Сохранение пользовательских настроек
        saveCustomBtn.addEventListener('click', () => {
            difficultySettings.custom = {
                minSize: parseInt(document.getElementById('customMinSize').value),
                maxSize: parseInt(document.getElementById('customMaxSize').value),
                ballLifetime: parseInt(document.getElementById('customLifetime').value),
                spawnInterval: parseInt(document.getElementById('customInterval').value),
                bonusChance: parseFloat(document.getElementById('customBonusChance').value),
                penaltyChance: parseFloat(document.getElementById('customPenaltyChance').value),
                movingChance: parseFloat(document.getElementById('customMovingChance').value),
                gameTime: parseInt(document.getElementById('customGameTime').value),
                levelName: "Пользовательский уровень"
            };
            
            alert('Настройки сохранены!');
        });
        
        // Применение пользовательского уровня
        applyCustomBtn.addEventListener('click', () => {
            if (gameActive) return;
            
            difficultyButtons.forEach(b => b.classList.remove('active'));
            document.querySelector('.difficulty-btn[data-difficulty="custom"]').classList.add('active');
            currentDifficulty = 'custom';
            
            timeLeft = difficultySettings.custom.gameTime;
            timeElement.textContent = timeLeft;
            
            levelIndicator.textContent = difficultySettings.custom.levelName;
            
            alert('Пользовательский уровень применен!');
        });
        
        // Начало игры
        function startGame() {
            if (gameActive) return;
            
            resetGame();
            gameActive = true;
            startBtn.textContent = "Пауза";
            
            // Обновление таймера
            gameInterval = setInterval(() => {
                timeLeft--;
                timeElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
                
                // Увеличиваем сложность со временем
                if (timeLeft % 10 === 0 && timeLeft > 0) {
                    increaseDifficulty();
                }
            }, 1000);
            
            // Создание шариков
            const settings = difficultySettings[currentDifficulty];
            ballInterval = setInterval(createBall, settings.spawnInterval);
            
            // Скрыть сообщение
            messageElement.style.opacity = '0';
            
            // Показать комбо-счетчик
            comboCounter.style.display = 'block';
        }
        
        // Увеличение сложности во время игры
        function increaseDifficulty() {
            if (currentDifficulty === 'hardcore') {
                // Для хардкора увеличиваем сложность еще больше
                const balls = document.querySelectorAll('.ball');
                balls.forEach(ball => {
                    if (Math.random() < 0.3) {
                        ball.classList.add('moving');
                    }
                });
                
                // Увеличиваем скорость появления шариков
                clearInterval(ballInterval);
                const settings = difficultySettings[currentDifficulty];
                ballInterval = setInterval(createBall, Math.max(200, settings.spawnInterval - 50));
            }
        }
        
        // Пауза игры
        function pauseGame() {
            if (!gameActive) return;
            
            clearInterval(gameInterval);
            clearInterval(ballInterval);
            gameActive = false;
            startBtn.textContent = "Продолжить";
            
            messageElement.textContent = "Пауза";
            messageElement.style.opacity = '1';
        }
        
        // Создание шарика
        function createBall() {
            if (!gameActive) return;
            
            const ball = document.createElement('div');
            ball.className = 'ball';
            
            // Определяем, будет ли это бонусный или штрафной шарик
            const settings = difficultySettings[currentDifficulty];
            const isBonus = Math.random() < settings.bonusChance;
            const isPenalty = Math.random() < settings.penaltyChance;
            const isMoving = Math.random() < settings.movingChance;
            
            if (isBonus) {
                ball.classList.add('bonus');
            } else if (isPenalty) {
                ball.classList.add('penalty');
            }
            
            if (isMoving) {
                ball.classList.add('moving');
            }
            
            // Случайные свойства шарика
            const minSize = settings.minSize;
            const maxSize = settings.maxSize;
            const size = Math.random() * (maxSize - minSize) + minSize;
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            // Позиционирование шарика
            const maxX = gameContainer.offsetWidth - size;
            const maxY = gameContainer.offsetHeight - size;
            
            ball.style.width = `${size}px`;
            ball.style.height = `${size}px`;
            
            if (isPenalty) {
                ball.style.background = `radial-gradient(circle at 30% 30%, #FF0000, #800000)`;
            } else {
                ball.style.background = `radial-gradient(circle at 30% 30%, white, ${color})`;
            }
            
            ball.style.left = `${Math.random() * maxX}px`;
            ball.style.top = `${Math.random() * maxY}px`;
            
            // Добавляем текст для бонусных и штрафных шариков
            if (isBonus) {
                ball.textContent = "+10";
            } else if (isPenalty) {
                ball.textContent = "-5";
            }
            
            // Обработчик клика
            ball.addEventListener('click', () => {
                if (!gameActive) return;
                
                // Определяем количество очков
                let points = Math.max(1, Math.floor(60 / size));
                
                // Бонусные шарики дают больше очков
                if (isBonus) {
                    points += 10;
                    bonusCaught++;
                    bonusElement.textContent = bonusCaught;
                } else if (isPenalty) {
                    points = -5;
                    penaltyCaught++;
                    penaltyElement.textContent = penaltyCaught;
                    combo = 1;
                    comboElement.textContent = `x${combo}`;
                    comboCounter.textContent = `Комбо: x${combo}`;
                    clearTimeout(comboTimeout);
                }
                
                // Увеличиваем счет
                score += points * combo;
                scoreElement.textContent = score;
                
                if (points > 0) {
                    ballsCaught++;
                    caughtElement.textContent = ballsCaught;
                    
                    // Увеличиваем комбо
                    combo++;
                    comboElement.textContent = `x${combo}`;
                    comboCounter.textContent = `Комбо: x${combo}`;
                    
                    if (combo > maxCombo) {
                        maxCombo = combo;
                        maxComboElement.textContent = `x${maxCombo}`;
                    }
                    
                    // Сбрасываем комбо через 3 секунды
                    clearTimeout(comboTimeout);
                    comboTimeout = setTimeout(() => {
                        combo = 1;
                        comboElement.textContent = `x${combo}`;
                        comboCounter.textContent = `Комbo: x${combo}`;
                    }, 3000);
                }
                
                updateAccuracy();
                
                // Создаем всплывающий текст с очками
                if (points > 0) {
                    createScorePopup(ball, points * combo);
                } else {
                    createPenaltyPopup(ball, points);
                }
                
                // Анимация исчезновения
                ball.style.animation = 'disappear 0.3s forwards';
                
                // Удаляем шарик через некоторое время
                setTimeout(() => {
                    if (ball.parentNode) {
                        ball.parentNode.removeChild(ball);
                    }
                }, 300);
                
                // Проверяем достижения
                checkAchievements();
            });
            
            // Добавляем шарик в контейнер
            gameContainer.appendChild(ball);
            
            // Удаляем шарик через время, зависящее от сложности
            setTimeout(() => {
                if (ball.parentNode) {
                    ball.style.animation = 'disappear 0.5s forwards';
                    setTimeout(() => {
                        if (ball.parentNode) {
                            ball.parentNode.removeChild(ball);
                            if (!isPenalty) {
                                ballsMissed++;
                                missedElement.textContent = ballsMissed;
                                updateAccuracy();
                                
                                // Сбрасываем комбо при пропуске
                                combo = 1;
                                comboElement.textContent = `x${combo}`;
                                comboCounter.textContent = `Комбо: x${combo}`;
                                clearTimeout(comboTimeout);
                            }
                        }
                    }, 500);
                }
            }, settings.ballLifetime);
        }
        
        // Создание всплывающего текста с очками
        function createScorePopup(ball, points) {
            const rect = ball.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            const ballX = rect.left - containerRect.left + rect.width / 2;
            const ballY = rect.top - containerRect.top + rect.height / 2;
            
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${points}`;
            popup.style.left = `${ballX}px`;
            popup.style.top = `${ballY}px`;
            
            gameContainer.appendChild(popup);
            
            // Удаляем всплывающий текст после анимации
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 1000);
        }
        
        // Создание всплывающего текста с штрафом
        function createPenaltyPopup(ball, points) {
            const rect = ball.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            const ballX = rect.left - containerRect.left + rect.width / 2;
            const ballY = rect.top - containerRect.top + rect.height / 2;
            
            const popup = document.createElement('div');
            popup.className = 'penalty-popup';
            popup.textContent = `${points}`;
            popup.style.left = `${ballX}px`;
            popup.style.top = `${ballY}px`;
            
            gameContainer.appendChild(popup);
            
            // Удаляем всплывающий текст после анимации
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 1000);
        }
        
        // Обновление точности
        function updateAccuracy() {
            const total = ballsCaught + ballsMissed;
            const accuracy = total > 0 ? Math.round((ballsCaught / total) * 100) : 0;
            accuracyElement.textContent = `${accuracy}%`;
        }
        
        // Проверка достижений
        function checkAchievements() {
            if (score >= 50) {
                achievements[0].classList.add('unlocked');
            }
            
            if (score >= 150) {
                achievements[1].classList.add('unlocked');
            }
            
            if (score >= 300) {
                achievements[2].classList.add('unlocked');
            }
            
            if (score >= 500) {
                achievements[3].classList.add('unlocked');
            }
        }
        
        // Завершение игры
        function endGame() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(ballInterval);
            startBtn.textContent = "Начать заново";
            
            // Сбрасываем комбо
            combo = 1;
            comboElement.textContent = `x${combo}`;
            comboCounter.textContent = `Комбо: x${combo}`;
            comboCounter.style.display = 'none';
            clearTimeout(comboTimeout);
            
            // Показываем сообщение о результате
            messageElement.textContent = `Игра окончена!\nВаш счет: ${score}`;
            messageElement.style.opacity = '1';
            
            // Удаляем все шарики
            const balls = document.querySelectorAll('.ball');
            balls.forEach(ball => {
                ball.style.animation = 'disappear 0.5s forwards';
                setTimeout(() => {
                    if (ball.parentNode) {
                        ball.parentNode.removeChild(ball);
                    }
                }, 500);
            });
        }
        
        // Сброс игры
        function resetGame() {
            // Очищаем интервалы
            clearInterval(gameInterval);
            clearInterval(ballInterval);
            
            // Сбрасываем переменные
            score = 0;
            timeLeft = difficultySettings[currentDifficulty].gameTime;
            ballsCaught = 0;
            ballsMissed = 0;
            bonusCaught = 0;
            penaltyCaught = 0;
            combo = 1;
            maxCombo = 1;
            
            // Обновляем DOM
            scoreElement.textContent = score;
            timeElement.textContent = timeLeft;
            caughtElement.textContent = ballsCaught;
            missedElement.textContent = ballsMissed;
            bonusElement.textContent = bonusCaught;
            penaltyElement.textContent = penaltyCaught;
            accuracyElement.textContent = '0%';
            comboElement.textContent = `x${combo}`;
            maxComboElement.textContent = `x${maxCombo}`;
            comboCounter.textContent = `Комбо: x${combo}`;
            comboCounter.style.display = 'none';
            startBtn.textContent = "Начать игру";
            
            // Сбрасываем достижения
            achievements.forEach(ach => ach.classList.remove('unlocked'));
            
            // Удаляем все шарики
            const balls = document.querySelectorAll('.ball');
            balls.forEach(ball => {
                if (ball.parentNode) {
                    ball.parentNode.removeChild(ball);
                }
            });
            
            // Скрываем сообщение
            messageElement.style.opacity = '0';
            
            gameActive = false;
        }
        
        // Обработчики событий для кнопок
        startBtn.addEventListener('click', () => {
            if (gameActive) {
                pauseGame();
            } else {
                startGame();
            }
        });
        
        resetBtn.addEventListener('click', resetGame);
    </script>
</body>
</html>